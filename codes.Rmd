---
title: "codes"
author: "Tim"
date: "2022-12-12"
output: html_document
---
```{r}
#package
if (!require("dplyr")) install.packages("dplyr")
library(dplyr)
library(knitr)
knitr::opts_chunk$set(cache = TRUE, warning = FALSE, 
                      message = FALSE, cache.lazy = FALSE)
```
# step 1 -- get all wanted variables from different data set
```{r}
#sort the data
### get data1
rawdata <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/IGF1data.csv')
data <- rawdata %>%
  select(ID, APOE4_status, family_history_AD, Sex, Age_Baseline, age1of3groups, SmokingY08, AlcoholY08, BMI_Y08andY12andY14_mean, rsfMRI_Component1, rsfMRI_Component5, rsfMRI_Component7, rsfMRI_Component9, rsfMRI_Component13, rsfMRI_Component14, rsfMRI_Component20)
#data1 includes fMRI, sex, age, AOPE4, smoking, alcohol, family history, and BMI
rm(rawdata)
write.csv(data, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\data1.csv", row.names=FALSE)
rm(list = ls())
```

```{r}
### get data2 -- AOPE4 & Tomm40_650
rawdata <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/UKB_Jan_27_2020.csv')
data <- rawdata %>%
  select(EID, APOE_all, T40_Gcar)
#data1 includes sex, age, AOPE4, TOMM40, family history
rm(rawdata)
#set APOE state, syntax is from https://www.statology.org/replace-values-in-data-frame-r/
data['APOE_all'][data['APOE_all']=='e2/e4'|data['APOE_all']=='e4/e3'|data['APOE_all']=='e4/e4'] <- '1'
data['APOE_all'][data['APOE_all']=='e2/e3'|data['APOE_all']=='e3/e3'|data['APOE_all']=='e2/e2'] <- '0'
data['APOE_all'][data['APOE_all']=='NA/NA'] <- 'NA'
colnames(data)[1]<-"eid"
write.csv(data, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\data2.csv", row.names=FALSE)
rm(list = ls())
```

```{unix}
#get data3
#cheese and milk data is extracted by Unix because the original data is too large
## this version of cheese and milk type is from the rawdata
$ awk -F',' -v OFS=, '{print $1,$50,$51,$52,$53,$54,$55,$56,$57}' ukb42102_2020May26_Genomic_Medical.csv > rawdata.csv
#rawdata is renamed data3 which includes "CheeseBaselineL"-1408-0.0, "Cheese1repeatL"1408-1.0, "CheeseImagingVisitL"1408-2.0, "MilkTypebaselineL"1418-0.0, "MilkType1repeatL"1418-1.0, "MilkTypeImageVisitL"1418-2.0
```


```{r}
### get data4 -- cheese intake, Red wine intake, milk type from Brandon's data
rawdata <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/UKBiobank_Masterfile_rename.csv')
data <- rawdata %>%
  select(eid, CheeseBaseline, Cheese1repeat, CheeseImagingVisit, MilkTypebaseline, MilkType1repeat, MilkTypeImageVisit,RedWine_Baselineb,RedWine_1repeatb,Redwine_imageb)
rm(rawdata)
write.csv(data, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\data4.csv", row.names=FALSE)
rm(list = ls())
# https://biobank.ndph.ox.ac.uk/showcase/field.cgi?id=1408 cheese dictionary
# cheese intake: "0 : Never 1 : Less than once a week 2 : Once a week 3 : 2-4 times a week 4 : 5-6 times a week 5 : Once or more daily  -1 : Do not know  -3 : Prefer not to answer"
# milk type: 1 : Full cream 2 : Semi-skimmed 3 : Skimmed 4 : Soya 5 : Other type of milk 6 : Never/rarely have milk -1 : Do not know -3 : Prefer not to answer
```

```{unix}
### get data5 -- get milk intake
### this raw data is too large, so I have to use unix
# step 1: get the header line
$ egrep "eid" ukb42166_2020JUN01.csv > header_ukb42166.csv
# check wanted vairables to know which columes they are
$ awk -F',' -v OFS=, '{print $1,$3624,$3625,$3626,$3627,$3628,$3629,$3630,$3631,$3632,$3633,$3754,$3755,$3756,$3757,$3758}' ukb42166_2020JUN01.csv > data5.csv
# data5 includes 100520-0.0	100520-1.0	100520-2.0	100520-3.0	100520-4.0	100530-0.0	100530-1.0	100530-2.0	100530-3.0	100530-4.0	100920-0.0	100920-1.0	100920-2.0	100920-3.0	100920-4.0, naming MilkIntakeBaseline	MilkIntake1	MilkIntake2	MilkIntake3	MilkIntake4	FMilkIntakeBaseline	FMilkIntake1	FMilkIntake2	FMilkIntake3	FMilkIntake4	MilkTypeBaseline	MilkType1	MilkType2	MilkType3	MilkType4
# data5_redwine is for 24h red wine data. It is made by using the same method of data5
```
#step 2 merge 5 data
```{r}
###data1 and data2 have different ID names. THey are changed to eid manually
#merge five data together
#merge the least sample, in which only same participants are kept
dataa <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data1.csv')
datab <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data2.csv')
datac<-merge(dataa,datab,by="eid")
rm(dataa)
rm(datab)
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/data3.csv')
datab<-merge(dataa,datac,by="eid")
rm(dataa)
rm(datac)
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/data4.csv')
datac<-merge(dataa,datab,by="eid")
rm(dataa)
rm(datab)
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/data5.csv')
datab<-merge(dataa,datac,by="eid")
rm(dataa)
rm(datac)
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/data5_redwine.csv')
datac<-merge(dataa,datab,by="eid")
rm(dataa)
rm(datab)
colnames(datac)[1]<-"EID"
write.csv(datac, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
#merge five data together
#merge the most sample, in which all participants are kept
#!this function is not used because it's meaningless to keep all participants.
datac<-merge(dataa,datab,by="eid", all.x =TRUE, all.y =TRUE)
```

```{r}
#add townsend data (189)
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_mean.csv')
datab<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/data6_townsend.csv')
datac<-merge(dataa,datab,by="eid")
rm(dataa)
rm(datab)
colnames(datac)[1]<-"EID"
write.csv(datac, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_all.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
#add IC10
rawdata <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/IGF1data.csv')
dataa <- rawdata %>%
  select(eid, rsfMRI_Component10)
datab<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_all.csv')
datac<-merge(dataa,datab,by="eid")
rm(dataa)
rm(datab)
colnames(datac)[1]<-"EID"
write.csv(datac, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_data.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{unix}
#add cheese24 hour data
### get data7 -- get cheese 24 data
### this raw data is too large, so I have to use unix
# step 1: get the header line
$ egrep "eid" ukb42166_2020JUN01.csv > header_ukb42166.csv
# check wanted vairables to know which columes they are (4159-4218)
$ awk -F',' -v OFS=, '{print $1,$4159,$4160,$4161,$4162,$4163,$4164,$4165,$4166,$4167,$4168,$4169,$4170,$4171,$4172,$4173,$4174,$4175,$4176,$4177,$4178,$4179,$4180,$4181,$4182,$4183,$4184,$4185,$4186,$4187,$4188,$4189,$4190,$4191,$4192,$4193,$4194,$4195,$4196,$4197,$4198,$4199,$4200,$4201,$4202,$4203,$4204,$4205,$4206,$4207,$4208,$4209,$4210,$4211,$4212,$4213,$4214,$4215,$4216,$4217,$4218}' ukb42166_2020JUN01.csv > data7_cheese24_all.csv
# data7 includes 102800-102910
```

```{r}
#merge data7 with others
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data.csv')
datab<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/data7_cheese24_all.csv')
datac<-merge(dataa,datab,by="eid")
rm(dataa)
rm(datab)
colnames(datac)[1]<-"EID"
write.csv(datac, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_data.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
#delete meaningless values in cheese24 data; 555 is half; 200 is NA, 0 is NA
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data.csv')
dataa$Cheese24_810Baseline[dataa$Cheese24_810Baseline == '555'] <- '0.5'
dataa$Cheese24_810Baseline[dataa$Cheese24_810Baseline == '200'] <- '0'
dataa$Cheese24_810Baseline[dataa$Cheese24_810Baseline == '300'] <- '3'
dataa$Cheese24_810Baseline[dataa$Cheese24_810Baseline == '0'] <- ''
dataa$Cheese24_810_1[dataa$Cheese24_810_1 == '555'] <- '0.5'
dataa$Cheese24_810_1[dataa$Cheese24_810_1 == '200'] <- '0'
dataa$Cheese24_810_1[dataa$Cheese24_810_1 == '300'] <- '3'
dataa$Cheese24_810_1[dataa$Cheese24_810_1 == '0'] <- ''
dataa$Cheese24_820Baseline[dataa$Cheese24_820Baseline == '555'] <- '0.5'
dataa$Cheese24_820Baseline[dataa$Cheese24_820Baseline == '200'] <- '0'
dataa$Cheese24_820Baseline[dataa$Cheese24_820Baseline == '300'] <- '3'
dataa$Cheese24_820_1[dataa$Cheese24_820_1 == '555'] <- '0.5'
dataa$Cheese24_820_1[dataa$Cheese24_820_1 == '200'] <- '0'
dataa$Cheese24_820_1[dataa$Cheese24_820_1 == '300'] <- '3'
dataa$Cheese24_820Baseline[dataa$Cheese24_820Baseline == '0'] <- ''
dataa$Cheese24_820_1[dataa$Cheese24_820_1 == '0'] <- ''
dataa$Cheese24_830Baseline[dataa$Cheese24_830Baseline == '555'] <- '0.5'
dataa$Cheese24_830Baseline[dataa$Cheese24_830Baseline == '200'] <- '0'
dataa$Cheese24_830Baseline[dataa$Cheese24_830Baseline == '300'] <- '3'
dataa$Cheese24_830_1[dataa$Cheese24_830_1 == '555'] <- '0.5'
dataa$Cheese24_830_1[dataa$Cheese24_830_1 == '200'] <- '0'
dataa$Cheese24_830_1[dataa$Cheese24_830_1 == '300'] <- '3'
dataa$Cheese24_830Baseline[dataa$Cheese24_830Baseline == '0'] <- ''
dataa$Cheese24_830_1[dataa$Cheese24_830_1 == '0'] <- ''
dataa$Cheese24_840Baseline[dataa$Cheese24_840Baseline == '555'] <- '0.5'
dataa$Cheese24_840Baseline[dataa$Cheese24_840Baseline == '200'] <- '0'
dataa$Cheese24_840Baseline[dataa$Cheese24_840Baseline == '300'] <- '3'
dataa$Cheese24_840_1[dataa$Cheese24_840_1 == '555'] <- '0.5'
dataa$Cheese24_840_1[dataa$Cheese24_840_1 == '200'] <- '0'
dataa$Cheese24_840_1[dataa$Cheese24_840_1 == '300'] <- '3'
dataa$Cheese24_850Baseline[dataa$Cheese24_850Baseline == '555'] <- '0.5'
dataa$Cheese24_850Baseline[dataa$Cheese24_850Baseline == '200'] <- '0'
dataa$Cheese24_850Baseline[dataa$Cheese24_850Baseline == '300'] <- '3'
dataa$Cheese24_850_1[dataa$Cheese24_850_1 == '555'] <- '0.5'
dataa$Cheese24_850_1[dataa$Cheese24_850_1 == '200'] <- '0'
dataa$Cheese24_850_1[dataa$Cheese24_850_1 == '300'] <- '3'
dataa$Cheese24_860Baseline[dataa$Cheese24_860Baseline == '555'] <- '0.5'
dataa$Cheese24_860Baseline[dataa$Cheese24_860Baseline == '200'] <- '0'
dataa$Cheese24_860Baseline[dataa$Cheese24_860Baseline == '300'] <- '3'
dataa$Cheese24_860_1[dataa$Cheese24_860_1 == '555'] <- '0.5'
dataa$Cheese24_860_1[dataa$Cheese24_860_1 == '200'] <- '0'
dataa$Cheese24_860_1[dataa$Cheese24_860_1 == '300'] <- '3'
dataa$Cheese24_870Baseline[dataa$Cheese24_870Baseline == '555'] <- '0.5'
dataa$Cheese24_870Baseline[dataa$Cheese24_870Baseline == '200'] <- '0'
dataa$Cheese24_870Baseline[dataa$Cheese24_870Baseline == '300'] <- '3'
dataa$Cheese24_870_1[dataa$Cheese24_870_1 == '555'] <- '0.5'
dataa$Cheese24_870_1[dataa$Cheese24_870_1 == '200'] <- '0'
dataa$Cheese24_870_1[dataa$Cheese24_870_1 == '300'] <- '3'
dataa$Cheese24_880Baseline[dataa$Cheese24_880Baseline == '555'] <- '0.5'
dataa$Cheese24_880Baseline[dataa$Cheese24_880Baseline == '200'] <- '0'
dataa$Cheese24_880Baseline[dataa$Cheese24_880Baseline == '300'] <- '3'
dataa$Cheese24_880_1[dataa$Cheese24_880_1 == '555'] <- '0.5'
dataa$Cheese24_880_1[dataa$Cheese24_880_1 == '200'] <- '0'
dataa$Cheese24_880_1[dataa$Cheese24_880_1 == '300'] <- '3'
dataa$Cheese24_890Baseline[dataa$Cheese24_890Baseline == '555'] <- '0.5'
dataa$Cheese24_890Baseline[dataa$Cheese24_890Baseline == '200'] <- '0'
dataa$Cheese24_890Baseline[dataa$Cheese24_890Baseline == '300'] <- '3'
dataa$Cheese24_890_1[dataa$Cheese24_890_1 == '555'] <- '0.5'
dataa$Cheese24_890_1[dataa$Cheese24_890_1 == '200'] <- '0'
dataa$Cheese24_890_1[dataa$Cheese24_890_1 == '300'] <- '3'
dataa$Cheese24_900Baseline[dataa$Cheese24_900Baseline == '555'] <- '0.5'
dataa$Cheese24_900Baseline[dataa$Cheese24_900Baseline == '200'] <- '0'
dataa$Cheese24_900Baseline[dataa$Cheese24_900Baseline == '300'] <- '3'
dataa$Cheese24_900_1[dataa$Cheese24_900_1 == '555'] <- '0.5'
dataa$Cheese24_900_1[dataa$Cheese24_900_1 == '200'] <- '0'
dataa$Cheese24_900_1[dataa$Cheese24_900_1 == '300'] <- '3'
dataa$Cheese24_910Baseline[dataa$Cheese24_910Baseline == '555'] <- '0.5'
dataa$Cheese24_910Baseline[dataa$Cheese24_910Baseline == '200'] <- '0'
dataa$Cheese24_910Baseline[dataa$Cheese24_910Baseline == '300'] <- '3'
dataa$Cheese24_910_1[dataa$Cheese24_910_1 == '555'] <- '0.5'
dataa$Cheese24_910_1[dataa$Cheese24_910_1 == '200'] <- '0'
dataa$Cheese24_910_1[dataa$Cheese24_910_1 == '300'] <- '3'
dataa$Cheese24_840Baseline[dataa$Cheese24_840Baseline == '0'] <- ''
dataa$Cheese24_840_1[dataa$Cheese24_840_1 == '0'] <- ''
dataa$Cheese24_850Baseline[dataa$Cheese24_850Baseline == '0'] <- ''
dataa$Cheese24_850_1[dataa$Cheese24_850_1 == '0'] <- ''
dataa$Cheese24_860Baseline[dataa$Cheese24_860Baseline == '0'] <- ''
dataa$Cheese24_860_1[dataa$Cheese24_860_1 == '0'] <- ''
dataa$Cheese24_870Baseline[dataa$Cheese24_870Baseline == '0'] <- ''
dataa$Cheese24_870_1[dataa$Cheese24_870_1 == '0'] <- ''
dataa$Cheese24_880Baseline[dataa$Cheese24_880Baseline == '0'] <- ''
dataa$Cheese24_880_1[dataa$Cheese24_880_1 == '0'] <- ''
dataa$Cheese24_890Baseline[dataa$Cheese24_890Baseline == '0'] <- ''
dataa$Cheese24_890_1[dataa$Cheese24_890_1 == '0'] <- ''
dataa$Cheese24_900Baseline[dataa$Cheese24_900Baseline == '0'] <- ''
dataa$Cheese24_900_1[dataa$Cheese24_900_1 == '0'] <- ''
dataa$Cheese24_910Baseline[dataa$Cheese24_910Baseline == '0'] <- ''
dataa$Cheese24_910_1[dataa$Cheese24_910_1 == '0'] <- ''
dataa$Cheese24_810_2[dataa$Cheese24_810_2 == '555'] <- '0.5'
dataa$Cheese24_810_2[dataa$Cheese24_810_2 == '200'] <- '0'
dataa$Cheese24_810_2[dataa$Cheese24_810_2 == '300'] <- '3'
dataa$Cheese24_810_2[dataa$Cheese24_810_2 == '0'] <- ''
dataa$Cheese24_820_2[dataa$Cheese24_820_2 == '555'] <- '0.5'
dataa$Cheese24_820_2[dataa$Cheese24_820_2 == '200'] <- '0'
dataa$Cheese24_820_2[dataa$Cheese24_820_2 == '300'] <- '3'
dataa$Cheese24_820_2[dataa$Cheese24_820_2 == '0'] <- ''
dataa$Cheese24_830_2[dataa$Cheese24_830_2 == '555'] <- '0.5'
dataa$Cheese24_830_2[dataa$Cheese24_830_2 == '200'] <- '0'
dataa$Cheese24_830_2[dataa$Cheese24_830_2 == '300'] <- '3'
dataa$Cheese24_830_2[dataa$Cheese24_830_2 == '0'] <- ''
dataa$Cheese24_840_2[dataa$Cheese24_840_2 == '555'] <- '0.5'
dataa$Cheese24_840_2[dataa$Cheese24_840_2 == '200'] <- '0'
dataa$Cheese24_840_2[dataa$Cheese24_840_2 == '300'] <- '3'
dataa$Cheese24_850_2[dataa$Cheese24_850_2 == '555'] <- '0.5'
dataa$Cheese24_850_2[dataa$Cheese24_850_2 == '200'] <- '0'
dataa$Cheese24_850_2[dataa$Cheese24_850_2 == '300'] <- '3'
dataa$Cheese24_860_2[dataa$Cheese24_860_2 == '555'] <- '0.5'
dataa$Cheese24_860_2[dataa$Cheese24_860_2 == '200'] <- '0'
dataa$Cheese24_860_2[dataa$Cheese24_860_2 == '300'] <- '3'
dataa$Cheese24_870_2[dataa$Cheese24_870_2 == '555'] <- '0.5'
dataa$Cheese24_870_2[dataa$Cheese24_870_2 == '200'] <- '0'
dataa$Cheese24_870_2[dataa$Cheese24_870_2 == '300'] <- '3'
dataa$Cheese24_880_2[dataa$Cheese24_880_2 == '555'] <- '0.5'
dataa$Cheese24_880_2[dataa$Cheese24_880_2 == '200'] <- '0'
dataa$Cheese24_880_2[dataa$Cheese24_880_2 == '300'] <- '3'
dataa$Cheese24_890_2[dataa$Cheese24_890_2 == '555'] <- '0.5'
dataa$Cheese24_890_2[dataa$Cheese24_890_2 == '200'] <- '0'
dataa$Cheese24_890_2[dataa$Cheese24_890_2 == '300'] <- '3'
dataa$Cheese24_900_2[dataa$Cheese24_900_2 == '555'] <- '0.5'
dataa$Cheese24_900_2[dataa$Cheese24_900_2 == '200'] <- '0'
dataa$Cheese24_900_2[dataa$Cheese24_900_2 == '300'] <- '3'
dataa$Cheese24_910_2[dataa$Cheese24_910_2 == '555'] <- '0.5'
dataa$Cheese24_910_2[dataa$Cheese24_910_2 == '200'] <- '0'
dataa$Cheese24_910_2[dataa$Cheese24_910_2 == '300'] <- '3'
dataa$Cheese24_840_2[dataa$Cheese24_840_2 == '0'] <- ''
dataa$Cheese24_850_2[dataa$Cheese24_850_2 == '0'] <- ''
dataa$Cheese24_860_2[dataa$Cheese24_860_2 == '0'] <- ''
dataa$Cheese24_870_2[dataa$Cheese24_870_2 == '0'] <- ''
dataa$Cheese24_880_2[dataa$Cheese24_880_2 == '0'] <- ''
dataa$Cheese24_890_2[dataa$Cheese24_890_2 == '0'] <- ''
dataa$Cheese24_900_2[dataa$Cheese24_900_2 == '0'] <- ''
dataa$Cheese24_910_2[dataa$Cheese24_910_2 == '0'] <- ''
dataa$Cheese24_810_3[dataa$Cheese24_810_3 == '555'] <- '0.5'
dataa$Cheese24_810_3[dataa$Cheese24_810_3 == '200'] <- '0'
dataa$Cheese24_810_3[dataa$Cheese24_810_3 == '300'] <- '3'
dataa$Cheese24_810_3[dataa$Cheese24_810_3 == '0'] <- ''
dataa$Cheese24_820_3[dataa$Cheese24_820_3 == '555'] <- '0.5'
dataa$Cheese24_820_3[dataa$Cheese24_820_3 == '200'] <- '0'
dataa$Cheese24_820_3[dataa$Cheese24_820_3 == '300'] <- '3'
dataa$Cheese24_820_3[dataa$Cheese24_820_3 == '0'] <- ''
dataa$Cheese24_830_3[dataa$Cheese24_830_3 == '555'] <- '0.5'
dataa$Cheese24_830_3[dataa$Cheese24_830_3 == '200'] <- '0'
dataa$Cheese24_830_3[dataa$Cheese24_830_3 == '300'] <- '3'
dataa$Cheese24_830_3[dataa$Cheese24_830_3 == '0'] <- ''
dataa$Cheese24_840_3[dataa$Cheese24_840_3 == '555'] <- '0.5'
dataa$Cheese24_840_3[dataa$Cheese24_840_3 == '200'] <- '0'
dataa$Cheese24_840_3[dataa$Cheese24_840_3 == '300'] <- '3'
dataa$Cheese24_850_3[dataa$Cheese24_850_3 == '555'] <- '0.5'
dataa$Cheese24_850_3[dataa$Cheese24_850_3 == '200'] <- '0'
dataa$Cheese24_850_3[dataa$Cheese24_850_3 == '300'] <- '3'
dataa$Cheese24_860_3[dataa$Cheese24_860_3 == '555'] <- '0.5'
dataa$Cheese24_860_3[dataa$Cheese24_860_3 == '200'] <- '0'
dataa$Cheese24_860_3[dataa$Cheese24_860_3 == '300'] <- '3'
dataa$Cheese24_870_3[dataa$Cheese24_870_3 == '555'] <- '0.5'
dataa$Cheese24_870_3[dataa$Cheese24_870_3 == '200'] <- '0'
dataa$Cheese24_870_3[dataa$Cheese24_870_3 == '300'] <- '3'
dataa$Cheese24_880_3[dataa$Cheese24_880_3 == '555'] <- '0.5'
dataa$Cheese24_880_3[dataa$Cheese24_880_3 == '200'] <- '0'
dataa$Cheese24_880_3[dataa$Cheese24_880_3 == '300'] <- '3'
dataa$Cheese24_890_3[dataa$Cheese24_890_3 == '555'] <- '0.5'
dataa$Cheese24_890_3[dataa$Cheese24_890_3 == '200'] <- '0'
dataa$Cheese24_890_3[dataa$Cheese24_890_3 == '300'] <- '3'
dataa$Cheese24_900_3[dataa$Cheese24_900_3 == '555'] <- '0.5'
dataa$Cheese24_900_3[dataa$Cheese24_900_3 == '200'] <- '0'
dataa$Cheese24_900_3[dataa$Cheese24_900_3 == '300'] <- '3'
dataa$Cheese24_910_3[dataa$Cheese24_910_3 == '555'] <- '0.5'
dataa$Cheese24_910_3[dataa$Cheese24_910_3 == '200'] <- '0'
dataa$Cheese24_910_3[dataa$Cheese24_910_3 == '300'] <- '3'
dataa$Cheese24_840_3[dataa$Cheese24_840_3 == '0'] <- ''
dataa$Cheese24_850_3[dataa$Cheese24_850_3 == '0'] <- ''
dataa$Cheese24_860_3[dataa$Cheese24_860_3 == '0'] <- ''
dataa$Cheese24_870_3[dataa$Cheese24_870_3 == '0'] <- ''
dataa$Cheese24_880_3[dataa$Cheese24_880_3 == '0'] <- ''
dataa$Cheese24_890_3[dataa$Cheese24_890_3 == '0'] <- ''
dataa$Cheese24_900_3[dataa$Cheese24_900_3 == '0'] <- ''
dataa$Cheese24_910_3[dataa$Cheese24_910_3 == '0'] <- ''
dataa$Cheese24_810_4[dataa$Cheese24_810_4 == '555'] <- '0.5'
dataa$Cheese24_810_4[dataa$Cheese24_810_4 == '200'] <- '0'
dataa$Cheese24_810_4[dataa$Cheese24_810_4 == '300'] <- '3'
dataa$Cheese24_810_4[dataa$Cheese24_810_4 == '0'] <- ''
dataa$Cheese24_820_4[dataa$Cheese24_820_4 == '555'] <- '0.5'
dataa$Cheese24_820_4[dataa$Cheese24_820_4 == '200'] <- '0'
dataa$Cheese24_820_4[dataa$Cheese24_820_4 == '300'] <- '3'
dataa$Cheese24_820_4[dataa$Cheese24_820_4 == '0'] <- ''
dataa$Cheese24_830_4[dataa$Cheese24_830_4 == '555'] <- '0.5'
dataa$Cheese24_830_4[dataa$Cheese24_830_4 == '200'] <- '0'
dataa$Cheese24_830_4[dataa$Cheese24_830_4 == '300'] <- '3'
dataa$Cheese24_830_4[dataa$Cheese24_830_4 == '0'] <- ''
dataa$Cheese24_840_4[dataa$Cheese24_840_4 == '555'] <- '0.5'
dataa$Cheese24_840_4[dataa$Cheese24_840_4 == '200'] <- '0'
dataa$Cheese24_840_4[dataa$Cheese24_840_4 == '300'] <- '3'
dataa$Cheese24_850_4[dataa$Cheese24_850_4 == '555'] <- '0.5'
dataa$Cheese24_850_4[dataa$Cheese24_850_4 == '200'] <- '0'
dataa$Cheese24_850_4[dataa$Cheese24_850_4 == '300'] <- '3'
dataa$Cheese24_860_4[dataa$Cheese24_860_4 == '555'] <- '0.5'
dataa$Cheese24_860_4[dataa$Cheese24_860_4 == '200'] <- '0'
dataa$Cheese24_860_4[dataa$Cheese24_860_4 == '300'] <- '3'
dataa$Cheese24_870_4[dataa$Cheese24_870_4 == '555'] <- '0.5'
dataa$Cheese24_870_4[dataa$Cheese24_870_4 == '200'] <- '0'
dataa$Cheese24_870_4[dataa$Cheese24_870_4 == '300'] <- '3'
dataa$Cheese24_880_4[dataa$Cheese24_880_4 == '555'] <- '0.5'
dataa$Cheese24_880_4[dataa$Cheese24_880_4 == '200'] <- '0'
dataa$Cheese24_880_4[dataa$Cheese24_880_4 == '300'] <- '3'
dataa$Cheese24_890_4[dataa$Cheese24_890_4 == '555'] <- '0.5'
dataa$Cheese24_890_4[dataa$Cheese24_890_4 == '200'] <- '0'
dataa$Cheese24_890_4[dataa$Cheese24_890_4 == '300'] <- '3'
dataa$Cheese24_900_4[dataa$Cheese24_900_4 == '555'] <- '0.5'
dataa$Cheese24_900_4[dataa$Cheese24_900_4 == '200'] <- '0'
dataa$Cheese24_900_4[dataa$Cheese24_900_4 == '300'] <- '3'
dataa$Cheese24_910_4[dataa$Cheese24_910_4 == '555'] <- '0.5'
dataa$Cheese24_910_4[dataa$Cheese24_910_4 == '200'] <- '0'
dataa$Cheese24_910_4[dataa$Cheese24_910_4 == '300'] <- '3'
dataa$Cheese24_840_4[dataa$Cheese24_840_4 == '0'] <- ''
dataa$Cheese24_850_4[dataa$Cheese24_850_4 == '0'] <- ''
dataa$Cheese24_860_4[dataa$Cheese24_860_4 == '0'] <- ''
dataa$Cheese24_870_4[dataa$Cheese24_870_4 == '0'] <- ''
dataa$Cheese24_880_4[dataa$Cheese24_880_4 == '0'] <- ''
dataa$Cheese24_890_4[dataa$Cheese24_890_4 == '0'] <- ''
dataa$Cheese24_900_4[dataa$Cheese24_900_4 == '0'] <- ''
dataa$Cheese24_910_4[dataa$Cheese24_910_4 == '0'] <- ''
write.csv(dataa, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_data_all.csv",na='',row.names=FALSE)
rm(list = ls())
```


```{r}
#making cheese24 data workable
#add all kinds of cheese used
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_cheese24_basline.csv')
dataa$all1 <- rowSums(dataa[,c("Cheese24_810Baseline","Cheese24_820Baseline","Cheese24_830Baseline","Cheese24_840Baseline","Cheese24_850Baseline","Cheese24_860Baseline","Cheese24_870Baseline","Cheese24_880Baseline","Cheese24_890Baseline","Cheese24_900Baseline","Cheese24_910Baseline")],na.rm=TRUE)
dataa$Cheese24sumBaseline<- ifelse(dataa$Cheese24Baseline=="NA",NA,dataa$all)
df2 <- dataa %>% select(-c(Cheese24Baseline,Cheese24_810Baseline,Cheese24_820Baseline,Cheese24_830Baseline,Cheese24_840Baseline,Cheese24_850Baseline,Cheese24_860Baseline,Cheese24_870Baseline,Cheese24_880Baseline,Cheese24_890Baseline,Cheese24_900Baseline,Cheese24_910Baseline,all1))
write.csv(df2, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_data_cheese24_Baslinea.csv",na='',row.names=FALSE)
rm(list = ls())

dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_cheese24_1.csv')
dataa$all1 <- rowSums(dataa[,c("Cheese24_810_1","Cheese24_820_1","Cheese24_830_1","Cheese24_840_1","Cheese24_850_1","Cheese24_860_1","Cheese24_870_1","Cheese24_880_1","Cheese24_890_1","Cheese24_900_1","Cheese24_910_1")],na.rm=TRUE)
dataa$Cheese24sum1<- ifelse(dataa$Cheese24_1=="NA",NA,dataa$all)
df2 <- dataa %>% select(-c(Cheese24_1,Cheese24_810_1,Cheese24_820_1,Cheese24_830_1,Cheese24_840_1,Cheese24_850_1,Cheese24_860_1,Cheese24_870_1,Cheese24_880_1,Cheese24_890_1,Cheese24_900_1,Cheese24_910_1,all1))
write.csv(df2, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_data_cheese24_1a.csv",na='',row.names=FALSE)
rm(list = ls())

dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_cheese24_2.csv')
dataa$all1 <- rowSums(dataa[,c("Cheese24_810_2","Cheese24_820_2","Cheese24_830_2","Cheese24_840_2","Cheese24_850_2","Cheese24_860_2","Cheese24_870_2","Cheese24_880_2","Cheese24_890_2","Cheese24_900_2","Cheese24_910_2")],na.rm=TRUE)
dataa$Cheese24sum2<- ifelse(dataa$Cheese24_2=="NA",NA,dataa$all)
df2 <- dataa %>% select(-c(Cheese24_2,Cheese24_810_2,Cheese24_820_2,Cheese24_830_2,Cheese24_840_2,Cheese24_850_2,Cheese24_860_2,Cheese24_870_2,Cheese24_880_2,Cheese24_890_2,Cheese24_900_2,Cheese24_910_2,all1))
write.csv(df2, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_data_cheese24_2a.csv",na='',row.names=FALSE)
rm(list = ls())

dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_cheese24_3.csv')
dataa$all1 <- rowSums(dataa[,c("Cheese24_810_3","Cheese24_820_3","Cheese24_830_3","Cheese24_840_3","Cheese24_850_3","Cheese24_860_3","Cheese24_870_3","Cheese24_880_3","Cheese24_890_3","Cheese24_900_3","Cheese24_910_3")],na.rm=TRUE)
dataa$Cheese24sum3<- ifelse(dataa$Cheese24_3=="NA",NA,dataa$all)
df2 <- dataa %>% select(-c(Cheese24_3,Cheese24_810_3,Cheese24_820_3,Cheese24_830_3,Cheese24_840_3,Cheese24_850_3,Cheese24_860_3,Cheese24_870_3,Cheese24_880_3,Cheese24_890_3,Cheese24_900_3,Cheese24_910_3,all1))
write.csv(df2, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_data_cheese24_3a.csv",na='',row.names=FALSE)
rm(list = ls())

dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_cheese24_4.csv')
dataa$all1 <- rowSums(dataa[,c("Cheese24_810_4","Cheese24_820_4","Cheese24_830_4","Cheese24_840_4","Cheese24_850_4","Cheese24_860_4","Cheese24_870_4","Cheese24_880_4","Cheese24_890_4","Cheese24_900_4","Cheese24_910_4")],na.rm=TRUE)
dataa$Cheese24sum4<- ifelse(dataa$Cheese24_4=="NA",NA,dataa$all)
df2 <- dataa %>% select(-c(Cheese24_4,Cheese24_810_4,Cheese24_820_4,Cheese24_830_4,Cheese24_840_4,Cheese24_850_4,Cheese24_860_4,Cheese24_870_4,Cheese24_880_4,Cheese24_890_4,Cheese24_900_4,Cheese24_910_4,all1))
write.csv(df2, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_data_cheese24_4a.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
#get cheese data with everything else
dataa <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_all.csv')
datab <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_cheese24_1a.csv')
datac<-merge(dataa,datab,by="EID")
rm(dataa)
rm(datab)
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_cheese24_2a.csv')
datab<-merge(dataa,datac,by="EID")
rm(dataa)
rm(datac)
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_cheese24_3a.csv')
datac<-merge(dataa,datab,by="EID")
rm(dataa)
rm(datab)
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_cheese24_4a.csv')
datab<-merge(dataa,datac,by="EID")
rm(dataa)
rm(datac)
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_cheese24_Baslinea.csv')
datac<-merge(dataa,datab,by="EID")
rm(dataa)
rm(datab)

write.csv(datac, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_withCheese.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
#add disease
dataa <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_withCheese.csv')
datab <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/UKBiobank_disease_Sept2017.csv')
datac<-merge(dataa,datab,by="EID")
rm(dataa)
rm(datab)
write.csv(datac, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_all_0317.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
#check the disease
# central nervous system diseases (G00-G99), cerebrovascular diseases (I60-I69), or mental and behavioral disorders (F00-F99)

df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_all_0317.csv')


variables <- c("X41202.0.0", "X41202.0.1", "X41202.0.2", "X41202.0.3", "X41202.0.4", "X41202.0.5", "X41202.0.6", "X41202.0.7", "X41202.0.8")
df[variables] <- lapply(df[variables], as.character)

# Function to check if a value starts with any of the given prefixes
starts_with_any <- function(value, prefixes) {
  any(sapply(prefixes, function(prefix) startsWith(value, prefix)))
}

# Create 'dig' variable
df$dig <- apply(df[variables], 1, function(row) {
  has_G <- any(sapply(row, function(value) starts_with_any(value, c("G"))))
  has_F <- any(sapply(row, function(value) starts_with_any(value, c("F"))))
  has_I6 <- any(sapply(row, function(value) starts_with_any(value, c("I6"))))
  
  ifelse(has_G && has_F || has_G && has_I6 || has_F && has_I6, "M",
         ifelse(has_G, "G",
                ifelse(has_F, "F",
                       ifelse(has_I6, "I", NA))))
})
write.csv(df, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_all_0317_disease.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_all_0317_disease.csv')
# count the number of cases valid values (non-NA values) in both variables APOE_all and T40_Gcar
# Count cases with valid values in both variables
valid_cases <- sum(!is.na(df$APOE_all) & !is.na(df$T40_Gcar))
# Display the result
print(valid_cases)
```
```{r}
#sort data
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_all_0317_d_final.csv')

# Count occurrences of each value in 'dig' variable, including invalid values
value_counts <- table(addNA(df$dig))

# Display the result
print(value_counts)

#           F     G     I     M  <NA> 
# 12025    90   479    55    12     0 

# Exclude cases with 'dig' values "F", "G", "I", and "M"
filtered_df <- df[!df$dig %in% c("F", "G", "I", "M"), ]
write.csv(filtered_df, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_final0317.csv",na='',row.names=FALSE)
rm(list = ls())
```



```{r}
# in this part, the diet consumption is considered as the total captures.
if (!require("dplyr")) install.packages("dplyr")
library(dplyr)
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_final0317.csv')
# add all cheese 24 hour variable together
df <- df %>%
  mutate(
    Cheese24sum = if_else(
      rowSums(is.na(select(., Cheese24sumBaseline, Cheese24sum1, Cheese24sum2, Cheese24sum3, Cheese24sum4))) == 5,
      NA_real_,
      coalesce(Cheese24sumBaseline, 0) +
        coalesce(Cheese24sum1, 0) +
        coalesce(Cheese24sum2, 0) +
        coalesce(Cheese24sum3, 0) +
        coalesce(Cheese24sum4, 0)
    )
  )
# add all milk intake variable together
df <- df %>%
  mutate(
    Milksum = if_else(
      rowSums(is.na(select(., MilkIntakeBaseline, MilkIntake1, MilkIntake2, MilkIntake3, MilkIntake4))) == 5,
      NA_real_,
      coalesce(MilkIntakeBaseline, 0) +
        coalesce(MilkIntake1, 0) +
        coalesce(MilkIntake2, 0) +
        coalesce(MilkIntake3, 0) +
        coalesce(MilkIntake4, 0)
    )
  )
# add all Fmilk intake variables together
df <- df %>%
  mutate(
    FMilksum = if_else(
      rowSums(is.na(select(., FMilkIntakeBaseline, FMilkIntake1, FMilkIntake2, FMilkIntake3, FMilkIntake4))) == 5,
      NA_real_,
      coalesce(FMilkIntakeBaseline, 0) +
        coalesce(FMilkIntake1, 0) +
        coalesce(FMilkIntake2, 0) +
        coalesce(FMilkIntake3, 0) +
        coalesce(FMilkIntake4, 0)
    )
  )

# add all red wine 24 hours together
df <- df %>%
  mutate(
    Redwine24sum = if_else(
      rowSums(is.na(select(., RedwineBase24, Redwine24_1, Redwine24_2, Redwine24_3, Redwine24_4))) == 5,
      NA_real_,
      coalesce(RedwineBase24, 0) +
        coalesce(Redwine24_1, 0) +
        coalesce(Redwine24_2, 0) +
        coalesce(Redwine24_3, 0) +
        coalesce(Redwine24_4, 0)
    )
  )
#in this version, the diet total consumption (red wine, cheese, milk, fmilk) variable is added
write.csv(df, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_final0319.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
# create mean value for each variables
if (!require("dplyr")) install.packages("dplyr")
library(dplyr)
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_final0319.csv')
# make cheese mean
df <- df %>%
  mutate(
    Cheese24mean = if_else(
      rowSums(is.na(select(., Cheese24sumBaseline, Cheese24sum1, Cheese24sum2, Cheese24sum3, Cheese24sum4))) == 5,
      NA_real_,
      rowMeans(select(., Cheese24sumBaseline, Cheese24sum1, Cheese24sum2, Cheese24sum3, Cheese24sum4), na.rm = TRUE)
    )
  )
# make milk mean
df <- df %>%
  mutate(
    milkmean = if_else(
      rowSums(is.na(select(., MilkIntakeBaseline, MilkIntake1, MilkIntake2, MilkIntake3, MilkIntake4))) == 5,
      NA_real_,
      rowMeans(select(., MilkIntakeBaseline, MilkIntake1, MilkIntake2, MilkIntake3, MilkIntake4), na.rm = TRUE)
    )
  )
# make Fmilk mean
df <- df %>%
  mutate(
    Fmilkmean = if_else(
      rowSums(is.na(select(., FMilkIntakeBaseline, FMilkIntake1, FMilkIntake2, FMilkIntake3, FMilkIntake4))) == 5,
      NA_real_,
      rowMeans(select(., FMilkIntakeBaseline, FMilkIntake1, FMilkIntake2, FMilkIntake3, FMilkIntake4), na.rm = TRUE)
    )
  )
# make red wine mean
df <- df %>%
  mutate(
    Redwine24mean = if_else(
      rowSums(is.na(select(., RedwineBase24, Redwine24_1, Redwine24_2, Redwine24_3, Redwine24_4))) == 5,
      NA_real_,
      rowMeans(select(., RedwineBase24, Redwine24_1, Redwine24_2, Redwine24_3, Redwine24_4), na.rm = TRUE)
    )
  )
# the 0320 version includes mean values
write.csv(df, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_final0320.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
#check cases numbers for valid values for both family history, APOE4, and TOMM40
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_final0320.csv')
valid_cases <- complete.cases(df$family_history_AD, df$T40_Gcar, df$APOE_all)
num_valid_cases <- sum(valid_cases)
rm(list = ls())
```

```{r}
#check cases numbers for valid values for all fixed predictors or explanatory variables
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_final0320.csv')
df1 <- df[complete.cases(df$family_history_AD, df$T40_Gcar, df$APOE_all, df$Sex, df$Age_Baseline, df$Townsend, df$SmokingY08, df$AlcoholY08, df$BMI_Y08andY12andY14_mean), ]
write.csv(df1, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_0527_valid.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
#select red wine data
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_0527_valid.csv')
df1 <- df[complete.cases(df$family_history_AD, df$T40_Gcar, df$APOE_all, df$Sex, df$Age_Baseline, df$Townsend, df$SmokingY08, df$AlcoholY08, df$BMI_Y08andY12andY14_mean, df$Redwine24mean), ]
write.csv(df1, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_redwine.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
#select milk data
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_0527_valid.csv')
df1 <- df[complete.cases(df$family_history_AD, df$T40_Gcar, df$APOE_all, df$Sex, df$Age_Baseline, df$Townsend, df$SmokingY08, df$AlcoholY08, df$BMI_Y08andY12andY14_mean, df$milkmean), ]
write.csv(df1, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_milk.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
#select cheese data
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_0527_valid.csv')
df1 <- df[complete.cases(df$family_history_AD, df$T40_Gcar, df$APOE_all, df$Sex, df$Age_Baseline, df$Townsend, df$SmokingY08, df$AlcoholY08, df$BMI_Y08andY12andY14_mean, df$Cheese24mean), ]
write.csv(df1, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_cheese.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
#get random effects data-- 54: initial assessment visit location (https://biobank.ndph.ox.ac.uk/ukb/field.cgi?id=54);52: month of birth (https://biobank.ndph.ox.ac.uk/ukb/field.cgi?id=52)
dfa <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_0527_valid.csv')
dfb <-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/random_effects.csv')
dfc<-merge(dfa,dfb,by="EID")
rm(dfa)
rm(dfb)
#dairy_data_0531.csv has two types of random effects data
write.csv(dfc, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_data_0531.csv",na='',row.names=FALSE)
rm(list = ls())
```

```{r}
# merge random effects into milk, cheese, and redwine data
dfa <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_cheese.csv')
dfb <-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/random_effects.csv')
dfc<-merge(dfa,dfb,by="EID")
rm(dfa)
write.csv(dfc, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_cheese_withRE.csv",na='',row.names=FALSE)
dfa <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_milk.csv')
dfc<-merge(dfa,dfb,by="EID")
rm(dfa)
write.csv(dfc, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_milk_withRE.csv",na='',row.names=FALSE)
dfa <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_redwine.csv')
dfc<-merge(dfa,dfb,by="EID")
rm(dfa)
write.csv(dfc, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairydata_redwine_withRE.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
#main effects test in R
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_milk_withRE.csv')
df$APOE_all <- as.factor(df$APOE_all)
df$T40_Gcar <- as.factor(df$T40_Gcar)
df$family_history_AD <- as.factor(df$family_history_AD)
df$Sex <- as.factor(df$Sex)
df$AlcoholY08 <- as.factor(df$AlcoholY08)
df$SmokingY08 <- as.factor(df$SmokingY08)
df$Assessment_0 <- as.factor(df$Assessment_0)

install.packages("lmerTest")
library(lmerTest)

# Fit the model
df$APOE_all <- as.factor(df$APOE_all)
df$T40_Gcar <- as.factor(df$T40_Gcar)
df$family_history_AD <- as.factor(df$family_history_AD)
df$Sex <- as.factor(df$Sex)
df$AlcoholY08 <- as.factor(df$AlcoholY08)
df$SmokingY08 <- as.factor(df$SmokingY08)
df$Assessment_0 <- as.factor(df$Assessment_0)
df$EID <- as.factor(df$EID)
model <- lmer(rsfMRI_Component13 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
              BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + milkmean + 
              (1 | Assessment_0), 
              data = df, REML=FALSE)

# Get the summary
summary(model)

```

```{Unix}
### get data8 -- get white wine and beer data
### this raw data is too large, so I have to use unix
# check wanted variables to know which columes they are (3664-3673)
$ awk -F',' -v OFS=, '{print $1,$3664,$3665,$3666,$3667,$3668,$3669,$3670,$3671,$3672,$3673}' ukb42166_2020JUN01.csv > data8_whitewine_beer.csv
# data8 includes 3664-3673
```

```{r}
#merge white wine and beer with all others
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/data8_whitewine_beer.csv')
dataa$White_wine_0[dataa$White_wine_0 == '555'] <- '0.5'
dataa$White_wine_0[dataa$White_wine_0 == '600'] <- '6'
dataa$White_wine_0[dataa$White_wine_0 == '111'] <- ''
dataa$White_wine_1[dataa$White_wine_1 == '555'] <- '0.5'
dataa$White_wine_1[dataa$White_wine_1 == '600'] <- '6'
dataa$White_wine_1[dataa$White_wine_1 == '111'] <- ''
dataa$White_wine_2[dataa$White_wine_2 == '555'] <- '0.5'
dataa$White_wine_2[dataa$White_wine_2 == '600'] <- '6'
dataa$White_wine_2[dataa$White_wine_2 == '111'] <- ''
dataa$White_wine_3[dataa$White_wine_3 == '555'] <- '0.5'
dataa$White_wine_3[dataa$White_wine_3 == '600'] <- '6'
dataa$White_wine_3[dataa$White_wine_3 == '111'] <- ''
dataa$White_wine_4[dataa$White_wine_4 == '555'] <- '0.5'
dataa$White_wine_4[dataa$White_wine_4 == '600'] <- '6'
dataa$White_wine_4[dataa$White_wine_4 == '111'] <- ''
dataa$Beer_0[dataa$Beer_0 == '555'] <- '0.5'
dataa$Beer_0[dataa$Beer_0 == '600'] <- '6'
dataa$Beer_0[dataa$Beer_0 == '111'] <- ''
dataa$Beer_1[dataa$Beer_1 == '555'] <- '0.5'
dataa$Beer_1[dataa$Beer_1 == '600'] <- '6'
dataa$Beer_1[dataa$Beer_1 == '111'] <- ''
dataa$Beer_2[dataa$Beer_2 == '555'] <- '0.5'
dataa$Beer_2[dataa$Beer_2 == '600'] <- '6'
dataa$Beer_2[dataa$Beer_2 == '111'] <- ''
dataa$Beer_3[dataa$Beer_3 == '555'] <- '0.5'
dataa$Beer_3[dataa$Beer_3 == '600'] <- '6'
dataa$Beer_3[dataa$Beer_3 == '111'] <- ''
dataa$Beer_4[dataa$Beer_4 == '555'] <- '0.5'
dataa$Beer_4[dataa$Beer_4 == '600'] <- '6'
dataa$Beer_4[dataa$Beer_4 == '111'] <- ''
datab <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairy_data_0531.csv')
datac<-merge(dataa,datab,by="EID")
write.csv(datac, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_alcohol_0604.csv",na='',row.names=FALSE)

```

```{r}
# To adjust p-values for multiple comparisons using the False Discovery Rate (FDR) in R, you can use the p.adjust function with the method set to "fdr".
# Assuming you have a vector of p-values
p_values <- c(0.272967, 0.086225, 0.004644, 0.131446, 0.105765, 0.936554, 0.000996, 0.122809, 0.155221, 0.208878, 0.242088, 0.028687, 0.087636, 0.630368, 0.320744, 0.830014, 0.232144, 0.402830, 0.563674, 0.230983, 0.010926)

# Adjust the p-values
adjusted_p_values <- p.adjust(p_values, method = "fdr")

# Print the adjusted p-values
print(adjusted_p_values)
```

```{Unix}
### get data9 -- get all alcohol data
$ awk -F’,’ -v OFS=, '{print $1,$2339,$2340,$2341,$2342,$2343,$2344,$2345,$2346,$2347,$2348,$2349,$2350,$2351,$2352,$2353,$2354,$2355,$2356,$2357,$2358,$2359,$2360,$2361,$2362,$2363,$2364,$2365,$2366,$2367,$2368,$2369,$2370,$2371,$2372,$2373,$2659,$2660,$2661,$2662,$2663,$2664,$2665,$2666,$2667,$2668,$2669,$2670,$2671,$2672,$2673,$3679,$3680,$3681,$3682,$3683}' ukb42166_2020JUN01.csv > data9_alcohol.csv
# it doesn't work because "awk" would make a too large data
# I used the following code
$ cols="1,"$(seq -s, 2339 2373)","$(seq -s, 3659 3673)","$(seq -s, 3679 3683)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data9_alcohol.csv
```

```{r}
#merge all alcohol data with the others
dataa <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data9_alcohol.csv')
datab <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_final0320.csv')
datac<-merge(dataa,datab,by="EID")
rm(dataa)
rm(datab)
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/random_effects.csv')
datab<-merge(dataa,datac,by="EID")
rm(dataa)
rm(datac)
write.csv(datab, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_alcohol_0609.csv",na='',row.names=FALSE)
rm(list=ls())
# 0609 has all alcohol data and dairy data
```

```{r}
if (!require("dplyr")) install.packages("dplyr")
library(dplyr)
#sort alcohol data
data <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairy_alcohol_0609.csv')
## make size values meaningful: 1=1(125ml); 2=1.4(170ml); 3=2(250ml)

# Specify the variables and their respective replacements
# Specify the columns
columns <- c('Size_White_wine.0.0', 'Size_White_wine.0.1', 'Size_White_wine.0.2', 
             'Size_White_wine.1.0', 'Size_White_wine.1.1', 'Size_White_wine.1.2', 
             'Size_White_wine.2.0', 'Size_White_wine.2.1', 'Size_White_wine.2.2', 
             'Size_White_wine.3.0', 'Size_White_wine.3.1', 'Size_White_wine.3.2', 
             'Size_White_wine.4.0', 'Size_White_wine.4.1', 'Size_White_wine.4.2', 
             'Size_Red_wine.0.0', 'Size_Red_wine.0.1', 'Size_Red_wine.1.0', 
             'Size_Red_wine.1.1', 'Size_Red_wine.2.0', 'Size_Red_wine.2.1', 
             'Size_Red_wine.3.0', 'Size_Red_wine.3.1', 'Size_Red_wine.4.0', 
             'Size_Red_wine.4.1', 'Size_Rose_wine.0.0', 'Size_Rose_wine.0.1', 
             'Size_Rose_wine.1.0', 'Size_Rose_wine.1.1', 'Size_Rose_wine.2.0', 
             'Size_Rose_wine.2.1', 'Size_Rose_wine.3.0', 'Size_Rose_wine.3.1', 
             'Size_Rose_wine.4.0', 'Size_Rose_wine.4.1')

# Replace values for each specified column
data <- data %>%
  mutate_at(vars(columns), function(x) case_when(
    x == 2 ~ 1.7,
    x == 3 ~ 2,
    x %in% c(4, 5) ~ NA_real_,
    TRUE ~ x
  ))
rm(columns)

# Calculate row means for alcohol size
# create a list of unique prefixes
wine_types <- c("White", "Red", "Rose")
wine_numbers <- 0:4

# loop over the prefixes
for (wine_type in wine_types) {
  for (wine_number in wine_numbers) {
    
    # generate the column names
    if (wine_type == "White") {
      cols <- paste0("Size_", wine_type, "_wine.", wine_number, ".", 0:2)
    } else {
      cols <- paste0("Size_", wine_type, "_wine.", wine_number, ".", 0:1)
    }
    
    # check if the columns exist in the data
    if (all(cols %in% names(data))) {
      
      # generate the new variable name
      new_var <- paste0("Size_", wine_type, "_", wine_number)
      
      # calculate the row means
      data <- data %>%
        mutate(!!new_var := rowMeans(select(., cols), na.rm = TRUE))
    }
  }
}
rm(list = setdiff(ls(), "data"))


# calculate white, rose, and red wine mean value (weighted with size)
# firstly, specify variables all alcohol variables for another set of replacements

columns <- c("White_wine.0.0", "White_wine.1.0", "White_wine.2.0", "White_wine.3.0", "White_wine.4.0", "Beer.0.0", "Beer.1.0", "Beer.2.0", "Beer.3.0", "Beer.4.0", "Spirits.0.0", "Spirits.1.0", "Spirits.2.0", "Spirits.3.0", "Spirits.4.0", "Rose_wine.0.0", "Rose_wine.1.0", "Rose_wine.2.0",	"Rose_wine.3.0", "Rose_wine.4.0")

data <- data %>% 
  mutate_at(vars(columns), function(x) case_when(
    x == 555 ~ 0.5,
    x == 600 ~ 6,
    x == 111 ~ NA_real_,
    TRUE ~ x
  ))
rm(columns)

# Create the White_ variables
for (i in 0:4) {
  data <- data %>%
    mutate(!!paste0("White_", i) := if_else(!is.na(get(paste0("Size_White_", i))) & 
                                              !is.na(get(paste0("White_wine.", i, ".0"))),
                                            get(paste0("Size_White_", i))*get(paste0("White_wine.", i, ".0")),
                                            if_else(!is.na(get(paste0("White_wine.", i, ".0"))),
                                                     get(paste0("White_wine.", i, ".0"))*1.4, NA_real_)))
}

# Create the Rose_ variables
for (i in 0:4) {
  data <- data %>%
    mutate(!!paste0("Rose_", i) := if_else(!is.na(get(paste0("Size_Rose_", i))) & 
                                             !is.na(get(paste0("Rose_wine.", i, ".0"))),
                                           get(paste0("Size_Rose_", i))*get(paste0("Rose_wine.", i, ".0")),
                                           if_else(!is.na(get(paste0("Rose_wine.", i, ".0"))),
                                                    get(paste0("Rose_wine.", i, ".0"))*1.4, NA_real_)))
}

# Create the Red_ variables
red_cols = c("RedwineBase24", "Redwine24_1", "Redwine24_2", "Redwine24_3", "Redwine24_4")
for (i in 0:4) {
  data <- data %>%
    mutate(!!paste0("Red_", i) := if_else(!is.na(get(paste0("Size_Red_", i))) & 
                                            !is.na(get(red_cols[i + 1])),
                                          get(paste0("Size_Red_", i))*get(red_cols[i + 1]),
                                          if_else(!is.na(get(red_cols[i + 1])),
                                                   get(red_cols[i + 1])*1.4, NA_real_)))
}
rm(list = setdiff(ls(), "data"))

# Create White_mean, Rose_mean, Red_mean

# Create Beer_mean, Spirits_mean
# Calculate row mean for each set of variables and create new columns
data$Beer_mean <- rowMeans(data[,c('Beer.0.0', 'Beer.1.0', 'Beer.2.0', 'Beer.3.0', 'Beer.4.0')], na.rm = TRUE)

data$Red_mean <- rowMeans(data[,c('Red_0', 'Red_1', 'Red_2', 'Red_3', 'Red_4')], na.rm = TRUE)

data$White_mean <- rowMeans(data[,c('White_0', 'White_1', 'White_2', 'White_3', 'White_4')], na.rm = TRUE)

data$Rose_mean <- rowMeans(data[,c('Rose_0', 'Rose_1', 'Rose_2', 'Rose_3', 'Rose_4')], na.rm = TRUE)

data$Spirits_mean <- rowMeans(data[,c('Spirits.0.0', 'Spirits.1.0', 'Spirits.2.0', 'Spirits.3.0', 'Spirits.4.0')], na.rm = TRUE)


write.csv(data, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\dairy_alcohol_0612.csv",na='',row.names=FALSE)
# Only get alcohol data
# Define the column names to remove
cols_to_remove <- c('Month_birth', 'Assessment_1', 'Assessment_image', 'Cheese24sumBaseline', 
                    'Cheese24sum4', 'Cheese24sum3', 'Cheese24sum2', 'MilkIntakeBaseline', 
                    'MilkIntake1', 'MilkIntake2', 'MilkIntake3', 'MilkIntake4', 
                    'MilkIntake_mean', 'FMilkIntakeBaseline', 'FMilkIntake1', 'FMilkIntake2', 
                    'FMilkIntake3', 'FMilkIntake4', 'FMilkIntake_mean', 'MilkTypeBaseline', 
                    'MilkType1', 'MilkType2', 'MilkType3', 'MilkType4', 'RedWine_Baselineb', 
                    'RedWine_1repeatb', 'Redwine_imageb', 'CheeseBaselineL', 'Cheese1repeatL', 
                    'CheeseImagingVisit', 'CheeseImagingVisitRepeatL', 'MilkTypebaselineL', 
                    'MilkType1repeatL', 'MilkTypeImageVisitL', 'MilkTypeImagingVisitRepeatL',
                    'age1of3groups', 'AlcoholY08', 'Cheese24Baseline', 'Cheese24_1', 
                    'Cheese24_2', 'Cheese24_3', 'Cheese24_4', 'Cheese24_810Baseline', 
                    'Cheese24_810_1', 'Cheese24_810_2', 'Cheese24_810_3', 'Cheese24_810_4', 
                    'Cheese24_810_mean', 'Cheese24_820Baseline', 'Cheese24_820_1', 
                    'Cheese24_820_2', 'Cheese24_820_3', 'Cheese24_820_4', 'Cheese24_830Baseline',
                    'Cheese24_830_1', 'Cheese24_830_2', 'Cheese24_830_3', 'Cheese24_830_4',
                    'Cheese24_840Baseline', 'Cheese24_840_1', 'Cheese24_840_2', 'Cheese24_840_3', 
                    'Cheese24_840_4', 'Cheese24_850Baseline', 'Cheese24_850_1', 'Cheese24_850_2', 
                    'Cheese24_850_3', 'Cheese24_850_4', 'Cheese24_860Baseline', 'Cheese24_860_1',
                    'Cheese24_860_2', 'Cheese24_860_3', 'Cheese24_860_4', 'Cheese24_870Baseline', 
                    'Cheese24_870_1', 'Cheese24_870_2', 'Cheese24_870_3', 'Cheese24_870_4', 
                    'Cheese24_880Baseline', 'Cheese24_880_1', 'Cheese24_880_2', 'Cheese24_880_3', 
                    'Cheese24_880_4', 'Cheese24_890Baseline', 'Cheese24_890_1', 'Cheese24_890_2', 
                    'Cheese24_890_3', 'Cheese24_890_4', 'Cheese24_900Baseline', 'Cheese24_900_1', 
                    'Cheese24_900_2', 'Cheese24_900_3', 'Cheese24_900_4', 'Cheese24_910Baseline', 
                    'Cheese24_910_1', 'Cheese24_910_2', 'Cheese24_910_3', 'Cheese24_910_4', 
                    'Cheese24sum1', 'Cheese24sum', 'Milksum', 'FMilksum', 'Redwine24sum', 
                    'Cheese24mean', 'milkmean', 'Fmilkmean', 'Redwine24mean')

# Remove the columns from the dataframe
data[cols_to_remove] <- list(NULL)

write.csv(data, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\alcohol_0614.csv",na='',row.names=FALSE)

rm(list=ls())
```

```{Unix}
### get data10 -- get all Continuous data -- UDI from 100002 to 100025
$ cols="1,"$(seq -s, 3338 3447)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data10_continuous.csv
### get data11 -- get liquid data -- UDI from 100150 to 100500; from 100540 to 100550
$ cols="1,"$(seq -s, 3448 3617)","$(seq -s, 3633 3642)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data11_liquids.csv
### get data12 -- get bread/dessert/grain data
$ cols="1,"$(seq -s, 3758 4157)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data12_grain_dessert.csv
### get data13 -- get egg/meat/fish/vegetarian data
$ cols="1,"$(seq -s, 4218 4697)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data13_meat_vege.csv
```

# The provided code is a set of Unix commands intended to extract certain columns from a .csv file and write these columns to new .csv files. To run all of these commands at once, you can put them into a shell script, and then execute the script. Here's how:

1. Open a text editor, and paste the following code into it:

```{bash}
#!/bin/bash

# get data10 -- continuous data -- UDI from 98677 to 99461
cols="1,"$(seq -s, 3338 3447)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data10_continuous.csv

# get data11 -- get liquid data -- UDI from 100150 to 100500; from 100540 to 100550
cols="1,"$(seq -s, 3448 3617)","$(seq -s, 3633 3642)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data11_liquids.csv

# get data12 -- get bread/dessert/grain data
cols="1,"$(seq -s, 3758 4157)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data12_grain_dessert.csv

# get data13 -- get egg/meat/fish/vegetarian data
cols="1,"$(seq -s, 4218 4697)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data13_meat_vege.csv
```

2. Save this file as `extract_columns.sh` or another name of your choosing with the `.sh` extension.

3. Open a terminal window, navigate to the directory where you saved `extract_columns.sh`, and then run the following command to make the script executable:

```{bash}
chmod +x extract_columns.sh
```

4. Now, you can run the script with this command:

```{bash}
./extract_columns.sh
```

This will execute all of the commands in the script, one after the other.


```{r}
#work on continuous data
#merge continuous variables with the others
dataa <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data10_continuous.csv')
datab <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_noIDV.csv')
datac<-merge(dataa,datab,by="EID")
rm(dataa)
rm(datab)
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/random_effects.csv')
datab<-merge(dataa,datac,by="EID")
rm(dataa)
rm(datac)
write.csv(datab, "C:\\Users\\timothy\\Documents\\GWAS_data\\dairy\\food_contious.csv",na='',row.names=FALSE)
rm(list=ls())
```